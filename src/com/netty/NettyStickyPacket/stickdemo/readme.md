1 粘包拆包基本概念

TPC是一个面向流的协议。所谓流就是没有边界的一串数据，如同河水般连成一片，其中并没有分界线。TCP底层并不了解上层业务数据的具体含义，它会根据TCP缓冲区的具体情况进行包的划分，所以在业务上认为，一个完整的包可能会被TCP拆成多个包发送，也有可能把多个小包封装成一个包发送。这就是拆包和粘包的概念。
比如向对方发送信息：Good Morning Sit down please。先向对方问早，再请对方坐下。但实际情况有可能这样：
第一次接收：Good Morning Sit
第二次接收：down please


2 解决粘包拆包的途径

TCP是面向流的协议，消息中间没有明显的界限。那为了对消息进行区分，只能依靠上层的应用协议，往往采取如下方式；
[1] 消息长度固定。累计读取到长度总和为定长的LEN的报文后，就认为读取到一个完整的消息。将计数器置位，重新开始读取下个数据报。
[2] 将回车换行符作为消息结束符。如FTP协议，这种方式在文本协议中应用广泛。
[3] 将特殊的分隔符作为消息的结束标志。回车换行符就是一种特殊的结束符。
[4] 通过在消息头中定义长度字段来标识消息的总长度。

Netty提供了对应的解码器：LineBaseFrameDecoder、DelimiterBaseFrameDecoder、FixedLengthFrameDecoder等。具体示例参考《Netty权威指南》。下面分析一个粘包拆包的示例，和自定义解码器。